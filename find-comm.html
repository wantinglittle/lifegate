<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Welcome to Lifegate Community</title>
  <link href="style.css" rel="stylesheet" type="text/css" />
  
  <!-- EmailJS -->
  <script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    (function () {
      emailjs.init("vXc5-Hh3C7fIob-j5"); // Replace with your actual public key
    })();
  </script>
</head>
<body>
  <div class="wrapper">
    <header>
      <div class="header-logo">
        <a href="https://lifegatedenver.com/"><img src="images/lg_logo.svg" alt="Lifegate Church" height="40"></a>
      </div>
      <div class="header-content">
        <h1>Lifegate Community</h1>
        <p>Find and connect with church community</p>
      </div>
      <div class="header-actions">
        <a href="add-group.html" class="add-group-btn">Add My Community</a>
      </div>
    </header>

    <main>
      <!-- Search, Filter and Map Section -->
      <section class="main-content">
        <div class="search-sidebar">
          <div class="search-group">
            <label for="location-search">üìç Location Search:</label>
            <input type="text" id="location-search" placeholder="Enter zip code or address">
            <button id="search-location-btn">Search</button>
          </div>

          <div class="filter-group">
            <label for="day-filter">Day:</label>
            <select id="day-filter">
              <option value="">All Days</option>
              <option value="Monday">Monday</option>
              <option value="Tuesday">Tuesday</option>
              <option value="Wednesday">Wednesday</option>
              <option value="Thursday">Thursday</option>
              <option value="Friday">Friday</option>
              <option value="Saturday">Saturday</option>
              <option value="Sunday">Sunday</option>
            </select>
          </div>

          <div class="filter-group">
            <label for="audience-filter">Audience:</label>
            <select id="audience-filter">
              <option value="">All</option>
              <option value="Men">Men</option>
              <option value="Women">Women</option>
            </select>
          </div>

          <div class="filter-group">
            <label for="age-filter">Age Group:</label>
            <select id="age-filter">
              <option value="">All Ages</option>
              <option value="Teens">Teens</option>
              <option value="Young Adult">Young Adult</option>
              <option value="30-50">30-50</option>
              <option value="50+">50+</option>
            </select>
          </div>

          <div class="filter-buttons">
            <button id="apply-filters">Apply Filters</button>
            <button id="clear-filters">Clear Filters</button>
          </div>
        </div>

        <div class="map-container">
          <div id="map" style="height: 500px; width: 100%;"></div>
        </div>
      </section>

      <!-- Groups Listing Section -->
      <section class="groups-section">
        <h2>Communities (<span id="group-count">0</span>)</h2>
        <div id="groups-container"></div>
      </section>
    </main>

    <footer>
      <div><h4>Questions or suggestions about this site or about Lifegate Community?</h4></div>
      <div class="msg-church"><h4>Click here to message the church</h4></div>
    </footer>

    <!-- Full Description Modal -->
    <div id="info-modal" class="modal">
      <div class="modal-content">
        <span class="close-info">&times;</span>
        <h3 id="info-title"></h3>
        <p id="info-description"></p>
        <p><strong>Day:</strong> <span id="info-day"></span></p>
        <p><strong>Time:</strong> <span id="info-time"></span></p>
        <p><strong>Audience:</strong> <span id="info-audience"></span></p>
        <p><strong>Age Group:</strong> <span id="info-age-group"></span></p>
      </div>
    </div>

    <!-- Contact Form Modal -->
    <div id="contact-modal" class="modal">
      <div class="modal-content">
        <span class="close-contact">&times;</span>
        <h3>Contact Leader</h3>
        <form id="contact-form">
          <input type="hidden" id="contact-group-id">
          <div class="form-group">
            <label for="contact-name">Name:</label>
            <input type="text" id="contact-name" name="name" required>
          </div>
          <div class="form-group">
            <label for="contact-phone">Phone:</label>
            <input type="text" id="contact-phone" name="phone" placeholder="(555) 123-4567" maxlength="14">
          </div>
          <div class="form-group">
            <label for="contact-email">Email:</label>
            <input type="email" id="contact-email" name="email" required>
          </div>
          <div class="form-group">
            <label for="contact-message">Message:</label>
            <textarea id="contact-message" rows="4" name="message" required></textarea>
          </div>
          <button type="submit">Send Message</button>
        </form>
      </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="groupmsg-confirmation-modal" class="modal">
      <div class="modal-content">
        <span class="close-groupmsg-confirmation">&times;</span>
        <h3 id="info-title">Your message has been sent!</h3>
        <p id="groupmsg-description-text">
          You should hear back from the community leader in the next few days. Please keep an eye on your junk folder as messages often end up there.
          <br><br>Thank you for reaching out!
        </p>
      </div>
    </div>

    <!-- Load Google Maps dynamically and init map -->
    <script type="module">
      import { initMap } from './script.js';

      function loadGoogleMaps() {
        return new Promise((resolve, reject) => {
          if (window.google && window.google.maps) {
            return resolve();
          }

          const script = document.createElement("script");
          script.src = "https://maps.googleapis.com/maps/api/js?key=AIzaSyBaD2QPffJ15fk2E3VtQjDMRZStj1dMAlg&libraries=marker";
          script.async = true;
          script.defer = true;

          script.onload = resolve;
          script.onerror = reject;

          document.head.appendChild(script);
        });
      }

      loadGoogleMaps()
        .then(() => {
          initMap();
        })
        .catch((error) => {
          console.error("Failed to load Google Maps:", error);
          alert("Map failed to load. Please try again later.");
        });
    </script>
  </div>
</body>
</html>
